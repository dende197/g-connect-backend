{"version":3,"sources":["../src/_test.ts","../src/Client.ts","../src/util/Constants.ts","../src/util/encryptCodeVerifier.ts","../src/util/formatDate.ts","../src/util/randomString.ts","../src/util/generateLoginLink.ts","../src/util/getToken.ts","../src/util/handleOperation.ts","../src/BaseClient.ts","../src/util/getCode.ts","../src/util/importData.ts","../src/util/writeToFile.ts"],"sourcesContent":["import \"dotenv/config\";\nimport { Client } from \"./Client\";\n\nconsole.time();\nconst client = new Client({ debug: true });\n\nawait client.login();\nconst uid = client.dashboard?.bacheca.find((e) => e.listaAllegati.length)\n\t?.listaAllegati[0]?.pk;\n\nawait Promise.allSettled([\n\tclient.getCorsiRecupero(),\n\tclient\n\t\t.getCurriculum()\n\t\t.then((c) =>\n\t\t\tPromise.allSettled([\n\t\t\t\tclient.getStoricoBacheca(c.at(-1)!.pkScheda),\n\t\t\t\tclient.getStoricoBachecaAlunno(c.at(-1)!.pkScheda),\n\t\t\t]),\n\t\t),\n\tclient.getDettagliProfilo(),\n\tclient.getOrarioGiornaliero(),\n\tclient.getPCTOData(),\n\tclient.getRicevimenti(),\n\tclient.getTasse(),\n\tclient.getVotiScrutinio(),\n\tuid && client.getLinkAllegato(uid),\n]);\nawait client.logOut();\nconsole.timeEnd();\n","import { CookieClient } from \"http-cookie-agent/undici\";\nimport { existsSync } from \"node:fs\";\nimport { mkdir, rm } from \"node:fs/promises\";\nimport { join } from \"node:path\";\nimport { cwd, env } from \"node:process\";\nimport { CookieJar } from \"tough-cookie\";\nimport {\n\tfetch,\n\tinterceptors,\n\tPool,\n\ttype Dispatcher,\n\ttype RequestInfo,\n\ttype RequestInit,\n\ttype RetryHandler,\n} from \"undici\";\nimport type CacheHandler from \"undici/types/cache-interceptor\";\nimport { BaseClient } from \"./BaseClient\";\nimport type { ClientOptions, Credentials } from \"./types\";\nimport { getCode } from \"./util/getCode\";\nimport { importData } from \"./util/importData\";\nimport { writeToFile } from \"./util/writeToFile\";\n\nconst factory = (origin: import(\"url\").URL, opts: object): CookieClient =>\n\tnew CookieClient(origin, {\n\t\t...opts,\n\t\tcookies: { jar: new CookieJar() },\n\t});\n\n/**\n * Un client per interagire con l'API\n */\nexport class Client extends BaseClient {\n\t/**\n\t * Custom dispatcher.\n\t */\n\tdispatcher: Dispatcher;\n\n\toverride fetch = this.createFetch();\n\n\t/**\n\t * @param options - Le opzioni per il client\n\t */\n\tconstructor(\n\t\toptions: ClientOptions & {\n\t\t\t/**\n\t\t\t * Il percorso della cartella dove salvare i dati.\n\t\t\t * * Ignorato se `dataProvider` viene fornito\n\t\t\t */\n\t\t\tdataPath?: string | null;\n\n\t\t\t/**\n\t\t\t * Additional options for the pool\n\t\t\t */\n\t\t\tpoolOptions?: Pool.Options;\n\n\t\t\t/**\n\t\t\t * Retry options\n\t\t\t */\n\t\t\tretryOptions?: RetryHandler.RetryOptions;\n\n\t\t\t/**\n\t\t\t * Cache options\n\t\t\t */\n\t\t\tcacheOptions?: CacheHandler.CacheOptions;\n\t\t} = {},\n\t) {\n\t\tsuper(options);\n\t\tthis.credentials = {\n\t\t\tschoolCode: options.schoolCode ?? env.CODICE_SCUOLA,\n\t\t\tpassword: options.password ?? env.PASSWORD,\n\t\t\tusername: options.username ?? env.NOME_UTENTE,\n\t\t};\n\t\tthis.dispatcher = new Pool(BaseClient.BASE_URL, {\n\t\t\tallowH2: true,\n\t\t\tautoSelectFamily: true,\n\t\t\tfactory,\n\t\t\t...options.poolOptions,\n\t\t}).compose(\n\t\t\tinterceptors.retry({\n\t\t\t\tmaxRetries: 4,\n\t\t\t\tminTimeout: 100,\n\t\t\t\ttimeoutFactor: 4,\n\t\t\t\tmaxTimeout: 10_000,\n\t\t\t\t...options.retryOptions,\n\t\t\t}),\n\t\t\tinterceptors.cache({\n\t\t\t\tcacheByDefault: 3_600_000,\n\t\t\t\ttype: \"private\",\n\t\t\t\t...options.cacheOptions,\n\t\t\t}),\n\t\t);\n\t\tif (options.dataProvider !== null)\n\t\t\tthis.dataProvider ??= Client.createDataProvider(\n\t\t\t\toptions.dataPath ?? undefined,\n\t\t\t);\n\t}\n\n\tstatic createDataProvider(\n\t\tdataPath = join(cwd(), \".argo\"),\n\t): NonNullable<ClientOptions[\"dataProvider\"]> {\n\t\tlet exists = existsSync(dataPath);\n\n\t\treturn {\n\t\t\tread: (name) => importData(name, dataPath),\n\t\t\twrite: async (name, value) => {\n\t\t\t\tif (!exists) {\n\t\t\t\t\texists = true;\n\t\t\t\t\tawait mkdir(dataPath);\n\t\t\t\t}\n\t\t\t\treturn writeToFile(name, value, dataPath);\n\t\t\t},\n\t\t\treset: () => rm(dataPath, { recursive: true, force: true }),\n\t\t};\n\t}\n\n\tcreateFetch(): typeof window.fetch {\n\t\treturn (info, init) =>\n\t\t\tfetch(info as RequestInfo, {\n\t\t\t\tdispatcher: this.dispatcher,\n\t\t\t\t...(init as RequestInit),\n\t\t\t}) as unknown as Promise<Response>;\n\t}\n\n\tasync getCode() {\n\t\tif (\n\t\t\t[\n\t\t\t\tthis.credentials?.password,\n\t\t\t\tthis.credentials?.schoolCode,\n\t\t\t\tthis.credentials?.username,\n\t\t\t].includes(undefined)\n\t\t)\n\t\t\tthrow new TypeError(\"Password, school code, or username missing\");\n\t\treturn getCode(this.credentials as Credentials);\n\t}\n}\n","export const clientId = \"72fd6dea-d0ab-4bb9-8eaa-3ac24c84886c\";\nexport const defaultVersion = \"1.27.0\";\n","const encoder = new TextEncoder();\n\n/**\n * Crittografa un codice.\n * @param codeVerifier - Il codice\n * @returns Il codice crittografato\n */\nexport const encryptCodeVerifier = async (codeVerifier: string) =>\n\tbtoa(\n\t\tString.fromCharCode(\n\t\t\t...new Uint8Array(\n\t\t\t\tawait crypto.subtle.digest(\"SHA-256\", encoder.encode(codeVerifier)),\n\t\t\t),\n\t\t),\n\t)\n\t\t.replace(/\\+/g, \"-\")\n\t\t.replace(/\\//g, \"_\")\n\t\t.replace(/=+$/, \"\");\n","/**\n * Formatta una data dell'API\n * @param date - La data\n * @returns La data formattata\n */\nexport const formatDate = (date: Date | number | string) => {\n\tdate = new Date(date);\n\treturn `${date.getFullYear()}-${(date.getMonth() + 1)\n\t\t.toString()\n\t\t.padStart(2, \"0\")}-${date.getDate().toString().padStart(2, \"0\")} ${date\n\t\t.getHours()\n\t\t.toString()\n\t\t.padStart(2, \"0\")}:${date.getMinutes().toString().padStart(2, \"0\")}:${date\n\t\t.getSeconds()\n\t\t.toString()\n\t\t.padStart(2, \"0\")}.${date.getMilliseconds().toString().padStart(3, \"0\")}`;\n};\n","const characters =\n\t\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n/**\n * Genera una stringa casuale.\n * @param length - La lunghezza della stringa\n * @returns La stringa generata\n */\nexport const randomString = (length: number) => {\n\tlet result = \"\";\n\n\tfor (let i = 0; i < length; i++)\n\t\tresult += characters.charAt(Math.floor(Math.random() * characters.length));\n\treturn result;\n};\n","import type { LoginLink } from \"../types\";\nimport { clientId } from \"./Constants\";\nimport { encryptCodeVerifier } from \"./encryptCodeVerifier\";\nimport { randomString } from \"./randomString\";\n\n/**\n * Genera un link per il login tramite browser.\n * @param param0 - Le opzioni per generare il link\n * @returns L'url generato con gli altri dati utilizzati\n */\nexport const generateLoginLink = async ({\n\tredirectUri = \"it.argosoft.didup.famiglia.new://login-callback\",\n\tscopes = [\"openid\", \"offline\", \"profile\", \"user.roles\", \"argo\"],\n\tcodeVerifier = randomString(43),\n\tchallenge,\n\tid = clientId,\n\tstate = randomString(22),\n\tnonce = randomString(22),\n}: {\n\tredirectUri?: string;\n\tscopes?: string[];\n\tcodeVerifier?: string;\n\tchallenge?: string;\n\tid?: string;\n\tstate?: string;\n\tnonce?: string;\n} = {}): Promise<LoginLink> => {\n\tchallenge ??= await encryptCodeVerifier(codeVerifier);\n\treturn {\n\t\turl: `https://auth.portaleargo.it/oauth2/auth?redirect_uri=${encodeURIComponent(\n\t\t\tredirectUri,\n\t\t)}&client_id=${id}&response_type=code&prompt=login&state=${state}&nonce=${nonce}&scope=${encodeURIComponent(\n\t\t\tscopes.join(\" \"),\n\t\t)}&code_challenge=${challenge}&code_challenge_method=S256`,\n\t\tredirectUri,\n\t\tscopes,\n\t\tcodeVerifier,\n\t\tchallenge,\n\t\tclientId: id,\n\t\tstate,\n\t\tnonce,\n\t};\n};\n","import type { APIToken, LoginLink } from \"../types\";\nimport { clientId } from \"./Constants\";\n\nexport const getToken = async (code: LoginLink & { code: string }) => {\n\tconst date = new Date();\n\tconst res = await fetch(\"https://auth.portaleargo.it/oauth2/token\", {\n\t\theaders: {\n\t\t\t\"content-type\": \"application/x-www-form-urlencoded\",\n\t\t},\n\t\tbody: new URLSearchParams({\n\t\t\tcode: code.code,\n\t\t\tgrant_type: \"authorization_code\",\n\t\t\tredirect_uri: \"it.argosoft.didup.famiglia.new://login-callback\",\n\t\t\tcode_verifier: code.codeVerifier,\n\t\t\tclient_id: clientId,\n\t\t}).toString(),\n\t\tmethod: \"POST\",\n\t});\n\tconst data: APIToken = await res.json();\n\tconst expireDate = new Date(res.headers.get(\"date\") ?? date);\n\n\tif (\"error\" in data)\n\t\tthrow new Error(`${data.error} ${data.error_description}`);\n\texpireDate.setSeconds(expireDate.getSeconds() + data.expires_in);\n\treturn Object.assign(data, { expireDate });\n};\n","import type { APIOperation } from \"../types\";\n\n/**\n * Gestisci dei dati dell'API contenenti un'operazione.\n * @param array - L'array ricevuto\n * @param old - L'eventuale array da modificare\n * @param pk - Una funzione per estrarre il pk\n * @returns Il nuovo array\n */\nexport const handleOperation = <T, P extends boolean>(\n\tarray: APIOperation<T, P>[],\n\told: Omit<\n\t\tExtract<APIOperation<T, P>, { operazione?: \"I\" }>,\n\t\t\"operazione\"\n\t>[] = [],\n\t...[pk]: P extends true\n\t\t? [\n\t\t\t\tpk: (\n\t\t\t\t\ta: Omit<\n\t\t\t\t\t\tExtract<APIOperation<T, P>, { operazione?: \"I\" }>,\n\t\t\t\t\t\t\"operazione\"\n\t\t\t\t\t>,\n\t\t\t\t) => string,\n\t\t\t]\n\t\t: []\n) => {\n\tconst toDelete: string[] = [];\n\tconst getPk =\n\t\t(pk as\n\t\t\t| ((\n\t\t\t\t\ta: Omit<\n\t\t\t\t\t\tExtract<APIOperation<T, P>, { operazione?: \"I\" }>,\n\t\t\t\t\t\t\"operazione\"\n\t\t\t\t\t>,\n\t\t\t  ) => string)\n\t\t\t| undefined) ?? ((a) => a.pk!);\n\n\tfor (const a of array)\n\t\tif (a.operazione === \"D\") toDelete.push(a.pk);\n\t\telse {\n\t\t\tconst { operazione, ...rest } = a;\n\t\t\tconst found = old.find((b) => a.pk === getPk(b));\n\n\t\t\tif (found) Object.assign(found, rest);\n\t\t\telse old.push(rest);\n\t\t}\n\treturn old.filter((a) => {\n\t\tconst p = getPk(a);\n\n\t\ttoDelete.unshift(p);\n\t\treturn !toDelete.includes(p, 1);\n\t});\n};\n","import type {\n\tAPIBacheca,\n\tAPIBachecaAlunno,\n\tAPICorsiRecupero,\n\tAPICurriculum,\n\tAPIDashboard,\n\tAPIDettagliProfilo,\n\tAPIDownloadAllegato,\n\tAPILogin,\n\tAPIOrarioGiornaliero,\n\tAPIPCTO,\n\tAPIProfilo,\n\tAPIResponse,\n\tAPIRicevimenti,\n\tAPIRicevutaTelematica,\n\tAPITasse,\n\tAPIToken,\n\tAPIVotiScrutinio,\n\tAPIWhat,\n\tClientOptions,\n\tCredentials,\n\tDashboard,\n\tHttpMethod,\n\tJson,\n\tLoginLink,\n\tReadyClient,\n\tToken,\n} from \"./types\";\nimport {\n\tclientId,\n\tdefaultVersion,\n\tformatDate,\n\tgetToken,\n\thandleOperation,\n\trandomString,\n} from \"./util\";\n\n/**\n * Un client per interagire con l'API\n */\nexport abstract class BaseClient {\n\tstatic readonly BASE_URL = \"https://www.portaleargo.it\";\n\n\t/**\n\t * A custom fetch implementation\n\t */\n\tfetch = fetch;\n\n\t/**\n\t * I dati del token\n\t */\n\ttoken?: Token;\n\n\t/**\n\t * I dati del login\n\t */\n\tloginData?: APILogin[\"data\"][number];\n\n\t/**\n\t * I dati del profilo\n\t */\n\tprofile?: APIProfilo[\"data\"];\n\n\t/**\n\t * I dati della dashboard\n\t */\n\tdashboard?: Dashboard;\n\n\t/**\n\t * Se scrivere nella console alcuni dati utili per il debug\n\t */\n\tdebug: boolean;\n\n\t/**\n\t * Headers aggiuntivi per ogni richiesta API\n\t */\n\theaders?: Record<string, string>;\n\n\t/**\n\t * Le funzioni per leggere e scrivere i dati.\n\t * Impostare questo valore forzerà `dataPath` a `null`\n\t */\n\tdataProvider?: NonNullable<ClientOptions[\"dataProvider\"]>;\n\n\t/**\n\t * La versione di didUp da specificare nell'header.\n\t * * Modificare questa opzione potrebbe creare problemi nell'utilizzo della libreria\n\t */\n\tversion: string;\n\n\t/**\n\t * Le credenziali usate per l'accesso\n\t */\n\tcredentials?: Partial<Credentials>;\n\n\t#ready = false;\n\n\t/**\n\t * @param options - Le opzioni per il client\n\t */\n\tconstructor(options: ClientOptions = {}) {\n\t\tthis.credentials = {\n\t\t\tschoolCode: options.schoolCode,\n\t\t\tpassword: options.password,\n\t\t\tusername: options.username,\n\t\t};\n\t\tthis.token = options.token;\n\t\tthis.loginData = options.loginData;\n\t\tthis.profile = options.profile;\n\t\tthis.dashboard = options.dashboard;\n\t\tthis.debug = options.debug ?? false;\n\t\tthis.version = options.version ?? defaultVersion;\n\t\tthis.headers = options.headers;\n\t\tif (options.dataProvider !== null) this.dataProvider = options.dataProvider;\n\t}\n\n\t/**\n\t * Controlla se il client è pronto\n\t */\n\tisReady(): this is ReadyClient {\n\t\treturn this.#ready;\n\t}\n\n\t/**\n\t * Effettua una richiesta API.\n\t * @param path - Il percorso della richiesta\n\t * @param options - Altre opzioni\n\t * @returns La risposta\n\t */\n\tapiRequest<T extends Json>(\n\t\tpath: string,\n\t\toptions?: Partial<{\n\t\t\tbody: Json;\n\t\t\tmethod: HttpMethod;\n\t\t\tnoWait: false;\n\t\t}>,\n\t): Promise<T>;\n\tapiRequest<T extends Json>(\n\t\tpath: string,\n\t\toptions: {\n\t\t\tbody?: Json;\n\t\t\tmethod?: HttpMethod;\n\t\t\tnoWait: true;\n\t\t},\n\t): Promise<Omit<Response, \"json\"> & { json: () => Promise<T> }>;\n\tasync apiRequest(\n\t\tpath: string,\n\t\toptions: Partial<{\n\t\t\tbody: Json;\n\t\t\tmethod: HttpMethod;\n\t\t\tnoWait: boolean;\n\t\t}> = {},\n\t): Promise<unknown> {\n\t\tconst headers: Record<string, string> = {\n\t\t\taccept: \"application/json\",\n\t\t\t\"argo-client-version\": this.version,\n\t\t\tauthorization: `Bearer ${this.token?.access_token ?? \"\"}`,\n\t\t};\n\n\t\toptions.method ??= options.body ? \"POST\" : \"GET\";\n\t\tif (options.body != null) headers[\"content-type\"] = \"application/json\";\n\t\tif (this.loginData) {\n\t\t\theaders[\"x-auth-token\"] = this.loginData.token;\n\t\t\theaders[\"x-cod-min\"] = this.loginData.codMin;\n\t\t}\n\t\tif (this.token)\n\t\t\theaders[\"x-date-exp-auth\"] = formatDate(this.token.expireDate);\n\t\tif (this.headers) Object.assign(headers, this.headers);\n\t\tconst res = await this.fetch(\n\t\t\t`${BaseClient.BASE_URL}/appfamiglia/api/rest/${path}`,\n\t\t\t{\n\t\t\t\theaders,\n\t\t\t\tmethod: options.method,\n\t\t\t\tbody: options.body != null ? JSON.stringify(options.body) : undefined,\n\t\t\t},\n\t\t);\n\n\t\tif (this.debug) console.debug(`${options.method} /${path} ${res.status}`);\n\t\treturn options.noWait ? res : (res.json() as unknown);\n\t}\n\n\t/**\n\t * Effettua il login.\n\t * @returns Il client aggiornato\n\t */\n\tasync login() {\n\t\tawait Promise.all([\n\t\t\tthis.token && this.dataProvider?.write(\"token\", this.token),\n\t\t\tthis.loginData && this.dataProvider?.write(\"login\", this.loginData),\n\t\t\tthis.profile && this.dataProvider?.write(\"profile\", this.profile),\n\t\t\tthis.dashboard && this.dataProvider?.write(\"dashboard\", this.dashboard),\n\t\t]);\n\t\tawait this.loadData();\n\t\tconst oldToken = this.token;\n\n\t\tawait this.refreshToken();\n\t\tif (!this.loginData) await this.getLoginData();\n\t\tif (oldToken) {\n\t\t\tthis.logToken({\n\t\t\t\toldToken,\n\t\t\t\tisWhat: this.profile !== undefined,\n\t\t\t}).catch(console.error);\n\t\t\tif (this.profile) {\n\t\t\t\tconst whatData = await this.what(\n\t\t\t\t\tthis.dashboard?.dataAggiornamento ?? this.profile.anno.dataInizio,\n\t\t\t\t);\n\n\t\t\t\tif (whatData.isModificato || whatData.differenzaSchede) {\n\t\t\t\t\tObject.assign(this.profile, whatData);\n\t\t\t\t\tvoid this.dataProvider?.write(\"profile\", this.profile);\n\t\t\t\t}\n\t\t\t\tthis.#ready = true;\n\t\t\t\tif (whatData.mostraPallino || !this.dashboard)\n\t\t\t\t\tawait this.getDashboard();\n\t\t\t\tthis.aggiornaData().catch(console.error);\n\t\t\t\treturn this as ReadyClient & this & { dashboard: Dashboard };\n\t\t\t}\n\t\t}\n\t\tif (!this.profile) await this.getProfilo();\n\t\tthis.#ready = true;\n\t\tawait this.getDashboard();\n\t\treturn this as ReadyClient & this & { dashboard: Dashboard };\n\t}\n\n\t/**\n\t * Carica i dati salvati localmente.\n\t */\n\tasync loadData() {\n\t\tif (!this.dataProvider?.read) return;\n\t\tconst [token, loginData, profile, dashboard] = await Promise.all([\n\t\t\tthis.token ? undefined : this.dataProvider.read(\"token\"),\n\t\t\tthis.loginData ? undefined : this.dataProvider.read(\"login\"),\n\t\t\tthis.profile ? undefined : this.dataProvider.read(\"profile\"),\n\t\t\tthis.dashboard ? undefined : this.dataProvider.read(\"dashboard\"),\n\t\t]);\n\n\t\tif (token)\n\t\t\tthis.token = { ...token, expireDate: new Date(token.expireDate) };\n\t\tif (loginData) this.loginData = loginData;\n\t\tif (profile) this.profile = profile;\n\t\tif (dashboard)\n\t\t\tthis.dashboard = {\n\t\t\t\t...dashboard,\n\t\t\t\tdataAggiornamento: new Date(dashboard.dataAggiornamento),\n\t\t\t};\n\t}\n\n\t/**\n\t * Aggiorna il client, se necessario.\n\t * @returns Il nuovo token\n\t */\n\tasync refreshToken() {\n\t\tif (!this.token) return this.getToken();\n\t\tif (this.token.expireDate.getTime() <= Date.now()) {\n\t\t\tconst date = new Date();\n\t\t\tconst res = await this.apiRequest<APIToken>(\"auth/refresh-token\", {\n\t\t\t\tbody: {\n\t\t\t\t\t\"r-token\": this.token.refresh_token,\n\t\t\t\t\t\"client-id\": clientId,\n\t\t\t\t\tscopes: `[${this.token.scope.split(\" \").join(\", \")}]`,\n\t\t\t\t\t\"old-bearer\": this.token.access_token,\n\t\t\t\t\t\"primo-accesso\": \"false\",\n\t\t\t\t\t\"ripeti-login\": \"false\",\n\t\t\t\t\t\"exp-bearer\": formatDate(this.token.expireDate),\n\t\t\t\t\t\"ts-app\": formatDate(date),\n\t\t\t\t\tproc: \"initState_global_random_12345\",\n\t\t\t\t\tusername: this.loginData?.username,\n\t\t\t\t},\n\t\t\t\tnoWait: true,\n\t\t\t});\n\t\t\tconst expireDate = new Date(res.headers.get(\"date\") ?? date);\n\t\t\tconst token = await res.json();\n\n\t\t\tif (\"error\" in token)\n\t\t\t\tthrow new Error(`${token.error} ${token.error_description}`);\n\t\t\texpireDate.setSeconds(expireDate.getSeconds() + token.expires_in);\n\t\t\tthis.token = Object.assign(this.token, token, { expireDate });\n\t\t\tvoid this.dataProvider?.write(\"token\", this.token);\n\t\t}\n\t\treturn this.token;\n\t}\n\n\t/**\n\t * Ottieni il token tramite l'API.\n\t * @param code - The code for the access\n\t * @returns I dati del token\n\t */\n\tasync getToken(code?: LoginLink & { code: string }) {\n\t\tcode ??= await this.getCode();\n\t\tconst { expireDate, ...token } = await getToken(code);\n\n\t\tthis.token = Object.assign(this.token ?? {}, token, { expireDate });\n\t\tvoid this.dataProvider?.write(\"token\", this.token);\n\t\treturn this.token;\n\t}\n\n\t/**\n\t * Rimuovi il profilo.\n\t */\n\tasync logOut() {\n\t\tif (!this.token || !this.loginData)\n\t\t\tthrow new Error(\"Client is not logged in!\");\n\t\tawait this.rimuoviProfilo();\n\t\tdelete this.token;\n\t\tdelete this.loginData;\n\t\tdelete this.profile;\n\t\tdelete this.dashboard;\n\t}\n\n\t/**\n\t * Ottieni i dettagli del profilo dello studente.\n\t * @returns I dati\n\t */\n\tasync getDettagliProfilo<T extends APIDettagliProfilo[\"data\"]>(old?: T) {\n\t\tthis.checkReady();\n\t\tconst body = await this.apiRequest<APIDettagliProfilo>(\"dettaglioprofilo\", {\n\t\t\tmethod: \"POST\",\n\t\t});\n\n\t\tif (!body.success) throw new Error(body.msg!);\n\t\treturn Object.assign(old ?? {}, body.data);\n\t}\n\n\t/**\n\t * Ottieni l'orario giornaliero.\n\t * @param date - Il giorno dell'orario\n\t * @returns I dati\n\t */\n\tasync getOrarioGiornaliero(date?: {\n\t\tyear?: number;\n\t\tmonth?: number;\n\t\tday?: number;\n\t}) {\n\t\tthis.checkReady();\n\t\tconst now = new Date();\n\t\tconst orario = await this.apiRequest<APIOrarioGiornaliero>(\n\t\t\t\"orario-giorno\",\n\t\t\t{\n\t\t\t\tbody: {\n\t\t\t\t\tdatGiorno: formatDate(\n\t\t\t\t\t\t`${date?.year ?? now.getFullYear()}-${\n\t\t\t\t\t\t\tdate?.month ?? now.getMonth() + 1\n\t\t\t\t\t\t}-${date?.day ?? now.getDate() + 1}`,\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\n\t\tif (!orario.success) throw new Error(orario.msg!);\n\t\treturn Object.values(orario.data.dati).flat();\n\t}\n\n\t/**\n\t * Ottieni il link per scaricare un allegato della bacheca.\n\t * @param uid - L'uid dell'allegato\n\t * @returns L'url\n\t */\n\tasync getLinkAllegato(uid: string) {\n\t\tthis.checkReady();\n\t\tconst download = await this.apiRequest<APIDownloadAllegato>(\n\t\t\t\"downloadallegatobacheca\",\n\t\t\t{ body: { uid } },\n\t\t);\n\n\t\tif (!download.success) throw new Error(download.msg);\n\t\treturn download.url;\n\t}\n\n\t/**\n\t * Ottieni il link per scaricare un allegato della bacheca alunno.\n\t * @param uid - l'uid dell'allegato\n\t * @param pkScheda - L'id del profilo\n\t * @returns L'url\n\t */\n\tasync getLinkAllegatoStudente(\n\t\tuid: string,\n\t\tpkScheda = this.profile?.scheda.pk,\n\t) {\n\t\tthis.checkReady();\n\t\tconst download = await this.apiRequest<APIDownloadAllegato>(\n\t\t\t\"downloadallegatobachecaalunno\",\n\t\t\t{ body: { uid, pkScheda } },\n\t\t);\n\n\t\tif (!download.success) throw new Error(download.msg);\n\t\treturn download.url;\n\t}\n\n\t/**\n\t * Ottieni i dati di una ricevuta telematica.\n\t * @param iuv - L'iuv del pagamento\n\t * @returns La ricevuta\n\t */\n\tasync getRicevuta(iuv: string) {\n\t\tthis.checkReady();\n\t\tconst ricevuta = await this.apiRequest<APIRicevutaTelematica>(\n\t\t\t\"ricevutatelematica\",\n\t\t\t{ body: { iuv } },\n\t\t);\n\n\t\tif (!ricevuta.success) throw new Error(ricevuta.msg);\n\t\tconst { success, msg, ...rest } = ricevuta;\n\n\t\treturn rest;\n\t}\n\n\t/**\n\t * Ottieni i voti dello scrutinio dello studente.\n\t * @returns I dati\n\t */\n\tasync getVotiScrutinio() {\n\t\tthis.checkReady();\n\t\tconst voti = await this.apiRequest<APIVotiScrutinio>(\"votiscrutinio\", {\n\t\t\tbody: {},\n\t\t});\n\n\t\tif (!voti.success) throw new Error(voti.msg!);\n\t\treturn voti.data.votiScrutinio[0]?.periodi;\n\t}\n\n\t/**\n\t * Ottieni i dati riguardo i ricevimenti dello studente.\n\t * @returns I dati\n\t */\n\tasync getRicevimenti<T extends APIRicevimenti[\"data\"]>(old?: T) {\n\t\tthis.checkReady();\n\t\tconst ricevimenti = await this.apiRequest<APIRicevimenti>(\"ricevimento\", {\n\t\t\tbody: {},\n\t\t});\n\n\t\tif (!ricevimenti.success) throw new Error(ricevimenti.msg!);\n\t\treturn Object.assign(old ?? {}, ricevimenti.data);\n\t}\n\n\t/**\n\t * Ottieni le tasse dello studente.\n\t * @param pkScheda - L'id del profilo\n\t * @returns I dati\n\t */\n\tasync getTasse(pkScheda = this.profile?.scheda.pk) {\n\t\tthis.checkReady();\n\t\tconst taxes = await this.apiRequest<APITasse>(\"listatassealunni\", {\n\t\t\tbody: { pkScheda },\n\t\t});\n\n\t\tif (!taxes.success) throw new Error(taxes.msg!);\n\t\tconst { success, msg, data, ...rest } = taxes;\n\n\t\treturn {\n\t\t\t...rest,\n\t\t\ttasse: data,\n\t\t};\n\t}\n\n\t/**\n\t * Ottieni i dati del PCTO dello studente.\n\t * @param pkScheda - L'id del profilo\n\t * @returns I dati\n\t */\n\tasync getPCTOData(pkScheda = this.profile?.scheda.pk) {\n\t\tthis.checkReady();\n\t\tconst pcto = await this.apiRequest<APIPCTO>(\"pcto\", {\n\t\t\tbody: { pkScheda },\n\t\t});\n\n\t\tif (!pcto.success) throw new Error(pcto.msg!);\n\t\treturn pcto.data.pcto;\n\t}\n\n\t/**\n\t * Ottieni i dati dei corsi di recupero dello studente.\n\t * @param pkScheda - L'id del profilo\n\t * @returns I dati\n\t */\n\tasync getCorsiRecupero<T extends APICorsiRecupero[\"data\"]>(\n\t\tpkScheda = this.profile?.scheda.pk,\n\t\told?: T,\n\t) {\n\t\tthis.checkReady();\n\t\tconst courses = await this.apiRequest<APICorsiRecupero>(\"corsirecupero\", {\n\t\t\tbody: { pkScheda },\n\t\t});\n\n\t\tif (!courses.success) throw new Error(courses.msg!);\n\t\treturn Object.assign(old ?? {}, courses.data);\n\t}\n\n\t/**\n\t * Ottieni il curriculum dello studente.\n\t * @param pkScheda - L'id del profilo\n\t * @returns I dati\n\t */\n\tasync getCurriculum(pkScheda = this.profile?.scheda.pk) {\n\t\tthis.checkReady();\n\t\tconst curriculum = await this.apiRequest<APICurriculum>(\n\t\t\t\"curriculumalunno\",\n\t\t\t{\n\t\t\t\tbody: { pkScheda },\n\t\t\t},\n\t\t);\n\n\t\tif (!curriculum.success) throw new Error(curriculum.msg!);\n\t\treturn curriculum.data.curriculum;\n\t}\n\n\t/**\n\t * Ottieni lo storico della bacheca.\n\t * @param pkScheda - L'id del profilo\n\t * @returns I dati\n\t */\n\tasync getStoricoBacheca(pkScheda: string) {\n\t\tthis.checkReady();\n\t\tconst bacheca = await this.apiRequest<APIBacheca>(\"storicobacheca\", {\n\t\t\tbody: { pkScheda },\n\t\t});\n\n\t\tif (!bacheca.success) throw new Error(bacheca.msg!);\n\t\treturn handleOperation(bacheca.data.bacheca);\n\t}\n\n\t/**\n\t * Ottieni lo storico della bacheca alunno.\n\t * @param pkScheda - L'id del profilo\n\t * @returns I dati\n\t */\n\tasync getStoricoBachecaAlunno(pkScheda: string) {\n\t\tthis.checkReady();\n\t\tconst bacheca = await this.apiRequest<APIBachecaAlunno>(\n\t\t\t\"storicobachecaalunno\",\n\t\t\t{\n\t\t\t\tbody: { pkScheda },\n\t\t\t},\n\t\t);\n\n\t\tif (!bacheca.success) throw new Error(bacheca.msg!);\n\t\treturn handleOperation(bacheca.data.bachecaAlunno);\n\t}\n\n\t/**\n\t * Ottieni i dati della dashboard.\n\t * @returns La dashboard\n\t */\n\tprivate async getDashboard() {\n\t\tthis.checkReady();\n\t\tconst date = new Date();\n\t\tconst res = await this.apiRequest<APIDashboard>(\"dashboard/dashboard\", {\n\t\t\tbody: {\n\t\t\t\tdataultimoaggiornamento: formatDate(\n\t\t\t\t\tthis.dashboard?.dataAggiornamento ?? this.profile.anno.dataInizio,\n\t\t\t\t),\n\t\t\t\topzioni: JSON.stringify(\n\t\t\t\t\tObject.fromEntries(\n\t\t\t\t\t\t(this.dashboard ?? this.loginData).opzioni.map((a) => [\n\t\t\t\t\t\t\ta.chiave,\n\t\t\t\t\t\t\ta.valore,\n\t\t\t\t\t\t]),\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t},\n\t\t\tnoWait: true,\n\t\t});\n\t\tconst body = await res.json();\n\n\t\tif (!body.success) throw new Error(body.msg!);\n\t\tconst [data] = body.data.dati;\n\n\t\tthis.dashboard = Object.assign(\n\t\t\t(data.rimuoviDatiLocali ? null : this.dashboard) ?? {},\n\t\t\t{\n\t\t\t\t...data,\n\t\t\t\tfuoriClasse: handleOperation(\n\t\t\t\t\tdata.fuoriClasse,\n\t\t\t\t\tdata.rimuoviDatiLocali ? undefined : this.dashboard?.fuoriClasse,\n\t\t\t\t),\n\t\t\t\tpromemoria: handleOperation(\n\t\t\t\t\tdata.promemoria,\n\t\t\t\t\tdata.rimuoviDatiLocali ? undefined : this.dashboard?.promemoria,\n\t\t\t\t),\n\t\t\t\tbacheca: handleOperation(\n\t\t\t\t\tdata.bacheca,\n\t\t\t\t\tdata.rimuoviDatiLocali ? undefined : this.dashboard?.bacheca,\n\t\t\t\t),\n\t\t\t\tvoti: handleOperation(\n\t\t\t\t\tdata.voti,\n\t\t\t\t\tdata.rimuoviDatiLocali ? undefined : this.dashboard?.voti,\n\t\t\t\t),\n\t\t\t\tbachecaAlunno: handleOperation(\n\t\t\t\t\tdata.bachecaAlunno,\n\t\t\t\t\tdata.rimuoviDatiLocali ? undefined : this.dashboard?.bachecaAlunno,\n\t\t\t\t),\n\t\t\t\tregistro: handleOperation(\n\t\t\t\t\tdata.registro,\n\t\t\t\t\tdata.rimuoviDatiLocali ? undefined : this.dashboard?.registro,\n\t\t\t\t),\n\t\t\t\tappello: handleOperation(\n\t\t\t\t\tdata.appello,\n\t\t\t\t\tdata.rimuoviDatiLocali ? undefined : this.dashboard?.appello,\n\t\t\t\t),\n\t\t\t\tprenotazioniAlunni: handleOperation(\n\t\t\t\t\tdata.prenotazioniAlunni,\n\t\t\t\t\tdata.rimuoviDatiLocali\n\t\t\t\t\t\t? undefined\n\t\t\t\t\t\t: this.dashboard?.prenotazioniAlunni,\n\t\t\t\t\t(a) => a.prenotazione.pk,\n\t\t\t\t),\n\t\t\t\tdataAggiornamento: new Date(res.headers.get(\"date\") ?? date),\n\t\t\t},\n\t\t);\n\t\tvoid this.dataProvider?.write(\"dashboard\", this.dashboard);\n\t\treturn this.dashboard;\n\t}\n\n\tprivate async getProfilo() {\n\t\tconst profile = await this.apiRequest<APIProfilo>(\"profilo\");\n\n\t\tif (!profile.success) throw new Error(profile.msg!);\n\t\tthis.profile = Object.assign(this.profile ?? {}, profile.data);\n\t\tvoid this.dataProvider?.write(\"profile\", this.profile);\n\t\treturn this.profile;\n\t}\n\n\tprivate async getLoginData() {\n\t\tconst login = await this.apiRequest<APILogin>(\"login\", {\n\t\t\tbody: {\n\t\t\t\t\"lista-opzioni-notifiche\": \"{}\",\n\t\t\t\t\"lista-x-auth-token\": \"[]\",\n\t\t\t\tclientID: randomString(163),\n\t\t\t},\n\t\t});\n\n\t\tif (!login.success) throw new Error(login.msg!);\n\t\tthis.loginData = Object.assign(this.loginData ?? {}, login.data[0]);\n\t\tvoid this.dataProvider?.write(\"login\", this.loginData);\n\t\treturn this.loginData;\n\t}\n\n\tprivate async logToken(options: { oldToken: Token; isWhat?: boolean }) {\n\t\tconst res = await this.apiRequest<APIResponse>(\"logtoken\", {\n\t\t\tbody: {\n\t\t\t\tbearerOld: options.oldToken.access_token,\n\t\t\t\tdateExpOld: formatDate(options.oldToken.expireDate),\n\t\t\t\trefreshOld: options.oldToken.refresh_token,\n\t\t\t\tbearerNew: this.token?.access_token,\n\t\t\t\tdateExpNew: this.token?.expireDate && formatDate(this.token.expireDate),\n\t\t\t\trefreshNew: this.token?.refresh_token,\n\t\t\t\tisWhat: (options.isWhat ?? false).toString(),\n\t\t\t\tisRefreshed: (\n\t\t\t\t\tthis.token?.access_token === options.oldToken.access_token\n\t\t\t\t).toString(),\n\t\t\t\tproc: \"initState_global_random_12345\",\n\t\t\t},\n\t\t});\n\n\t\tif (!res.success) throw new Error(res.msg!);\n\t}\n\n\tprivate async rimuoviProfilo() {\n\t\tconst res = await this.apiRequest<APIResponse>(\"rimuoviprofilo\", {\n\t\t\tbody: {},\n\t\t});\n\n\t\tif (!res.success) throw new Error(res.msg!);\n\t\tawait this.dataProvider?.reset();\n\t}\n\n\tprivate async what(\n\t\tlastUpdate: Date | number | string,\n\t\told?: APIWhat[\"data\"][\"dati\"][number],\n\t) {\n\t\tconst authToken = JSON.stringify([this.loginData?.token]);\n\t\tconst opzioni = (this.dashboard ?? this.loginData)?.opzioni;\n\t\tconst what = await this.apiRequest<APIWhat>(\"dashboard/what\", {\n\t\t\tbody: {\n\t\t\t\tdataultimoaggiornamento: formatDate(lastUpdate),\n\t\t\t\topzioni:\n\t\t\t\t\topzioni &&\n\t\t\t\t\tJSON.stringify(\n\t\t\t\t\t\tObject.fromEntries(opzioni.map((a) => [a.chiave, a.valore])),\n\t\t\t\t\t),\n\t\t\t\t\"lista-x-auth-token\": authToken,\n\t\t\t\t\"lista-x-auth-token-account\": authToken,\n\t\t\t},\n\t\t});\n\n\t\tif (!what.success) throw new Error(what.msg!);\n\t\treturn Object.assign(old ?? {}, what.data.dati[0]);\n\t}\n\n\tprivate async aggiornaData() {\n\t\tconst res = await this.apiRequest<APIResponse>(\"dashboard/aggiornadata\", {\n\t\t\tbody: { dataultimoaggiornamento: formatDate(new Date()) },\n\t\t});\n\n\t\tif (!res.success) throw new Error(res.msg!);\n\t}\n\n\tprivate checkReady(): asserts this is ReadyClient {\n\t\tif (!this.isReady()) throw new Error(\"Client is not logged in!\");\n\t}\n\n\tprotected abstract getCode(): Promise<LoginLink & { code: string }>;\n}\n","import { CookieAgent } from \"http-cookie-agent/undici\";\nimport { ok } from \"node:assert\";\nimport { URL, URLSearchParams } from \"node:url\";\nimport { CookieJar } from \"tough-cookie\";\nimport { interceptors, request } from \"undici\";\nimport type { Credentials } from \"../types\";\nimport { clientId } from \"./Constants\";\nimport { generateLoginLink } from \"./generateLoginLink\";\n\n/**\n * Ottieni il codice per il login.\n * @param credentials - Le credenziali per l'accesso\n * @returns I dati del codice da usare\n */\nexport const getCode = async (credentials: Credentials) => {\n\tconst link = await generateLoginLink();\n\tconst dispatcher = new CookieAgent({\n\t\tallowH2: true,\n\t\tautoSelectFamily: true,\n\t\tautoSelectFamilyAttemptTimeout: 1,\n\t\tcookies: { jar: new CookieJar() },\n\t}).compose(\n\t\tinterceptors.retry(),\n\t\tinterceptors.redirect({ maxRedirections: 3 }),\n\t);\n\tconst url = (await request(link.url, { dispatcher, maxRedirections: 0 } as any))\n\t\t.headers.location;\n\n\tok(typeof url === \"string\", \"Invalid login url\");\n\tconst challenge = new URL(url).searchParams.get(\"login_challenge\");\n\n\tok(challenge, \"Invalid login challenge\");\n\tconst { location } = await request(\n\t\t\"https://www.portaleargo.it/auth/sso/login\",\n\t\t{\n\t\t\tdispatcher,\n\t\t\tbody: new URLSearchParams({\n\t\t\t\tchallenge,\n\t\t\t\tclient_id: clientId,\n\t\t\t\tfamiglia_customer_code: credentials.schoolCode,\n\t\t\t\tlogin: \"true\",\n\t\t\t\tpassword: credentials.password,\n\t\t\t\tusername: credentials.username,\n\t\t\t}).toString(),\n\t\t\theaders: { \"content-type\": \"application/x-www-form-urlencoded\" },\n\t\t\tmethod: \"POST\",\n\t\t},\n\t).then((r) => r.headers);\n\n\tok(typeof location === \"string\", \"Invalid login redirect\");\n\tconst code = new URL(location).searchParams.get(\"code\");\n\n\tok(code, \"Invalid login code\");\n\treturn { ...link, code };\n};\n","import { readFile } from \"node:fs/promises\";\nimport { join } from \"node:path\";\nimport type { ReadData } from \"../types\";\n\n/**\n * Importa dei dati salvati in un file.\n * @param name - Il nome del file, escludendo l'estensione\n * @returns I dati importati\n */\nexport const importData = async <T extends keyof ReadData>(\n\tname: T,\n\tpath: string,\n) => {\n\ttry {\n\t\treturn JSON.parse(\n\t\t\tawait readFile(join(path, `${name}.json`), {\n\t\t\t\tencoding: \"utf8\",\n\t\t\t}),\n\t\t) as ReadData[T];\n\t} catch {\n\t\treturn undefined;\n\t}\n};\n","import { writeFile } from \"node:fs/promises\";\nimport { join } from \"node:path\";\n\n/**\n * Salva dei dati in un file JSON.\n * @param name - Il nome del file, escludendo l'estensione\n * @param value - I dati da scrivere\n */\nexport const writeToFile = (name: string, value: unknown, path: string) =>\n\twriteFile(`${join(path, name)}.json`, JSON.stringify(value)).catch(\n\t\tconsole.error,\n\t);\n"],"mappings":"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","names":["join","CookieJar","fetch","interceptors","uid","URLSearchParams","URLSearchParams","join","join","CookieJar","interceptors","join","fetch"]}